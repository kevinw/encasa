<!doctype html>
<html>
<head>
  <meta charset="utf-8" /> 
  <title>TODO ({{ todos_count }})</title>
  <base target="_parent">
  <style>
    {% include "style.css" %}
  </style>
</head>
<body>
  <h1><a href="/">TODO <span id="total_todos_count">({{ todos_count }})</span></a></h1>

  <ul class="deadlines unstyled-list navigable-list">
  {% for deadline in deadlines.deadlines %}
    <li>
      <a class="navigable-elem" href="{{ deadline.htmlLink }}">&#x23F0; {{ deadline.summary }}</a> 
      {{ deadline.start.to_naive_date().unwrap()|humanize_date }}
    </li>
  {% endfor %}
  </ul>


  <ul class="unstyled-list navigable-list">
  {% for local_file in local_files %}
    <li{% if local_file.needs_update() %} class="needs-update"{% endif %}>
      <a class="navigable-elem" href="editlocal://{{ local_file.desc.path }}">{{ local_file.desc.readable_name() }}</a>
      <span class="last-updated{% if local_file.needs_update() %} local-file-needs-update{% endif %}">
        last updated {{ local_file.duration_since_modified()|humanize_duration }}
      </span>
    </li>
  {% endfor %}
  </ul>

  <ul id="todo_list" class="unstyled-list navigable-list">
  {% for todo in todos %}
      <li class="todo-priority-{{ todo.task.priority }}{% if todo.task.finished %} todo-done{% endif %}">
      <input class="navigable-elem" type="checkbox" id="todo-{{- loop.index0 }}" value="{{ todo.task.calc_hash() }}"{% if todo.task.finished %} checked{% endif %}>
      <label> <!-- for="todo-{{- loop.index0 }}"> -->
        <span class="priority-label">{{ todo.task.priority_label() }}</span>
        {{ todo.subject_with_auto_project()|linkify|spanify|safe }}
        {% match todo.task.due_date %}
        {% when Some with (due_date) %}
          <span class="due-date-outer due-date-{{ due_date|date_when_css_class }}">
            due <span class="due-date">{{ due_date|humanize_date }}</span>
          </span>
        {% when None %}
        {% endmatch %}
      </label>
    </li>
  {% endfor %}
  </ul>

  <!--
  <pre>{{ json_dump }}</pre>
  -->

<script>
{% include "main.js" %}
</script>

</body>
</html>
